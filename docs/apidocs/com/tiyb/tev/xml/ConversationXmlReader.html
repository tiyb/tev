<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_181) on Tue Jun 11 12:52:20 EDT 2019 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ConversationXmlReader (tev v4.2.0 API)</title>
<meta name="date" content="2019-06-11">
<link rel="stylesheet" type="text/css" href="../../../../customstylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ConversationXmlReader (tev v4.2.0 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":9,"i4":9,"i5":9,"i6":9,"i7":9,"i8":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ConversationXmlReader.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/tiyb/tev/xml/BlogXmlReader.html" title="class in com.tiyb.tev.xml"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/tiyb/tev/xml/ConversationXmlReader.html" target="_top">Frames</a></li>
<li><a href="ConversationXmlReader.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.com.tiyb.tev.xml.TEVXmlReader">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.tiyb.tev.xml</div>
<h2 title="Class ConversationXmlReader" class="title">Class ConversationXmlReader</h2>
</div>
<div class="contentContainer">
<map id="APIVIZ" name="APIVIZ">
<area shape="rect" id="node1" href="TEVXmlReader.html" title="«static» TEVXmlReader" alt="" coords="5,13,117,53"/>
<area shape="rect" id="node2" href="ConversationXmlReader.html" title="«static» ConversationXmlReader" alt="" coords="55,99,217,139"/>
<area shape="rect" id="node3" title="«interface» XMLEventReader (javax.xml.stream)" alt="" coords="147,5,277,60"/>
</map>
<div id="apivizContainer" style="text-align: center;"><img src="ConversationXmlReader.png" usemap="#APIVIZ" border="0"></div>
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html" title="class in com.tiyb.tev.xml">com.tiyb.tev.xml.TEVXmlReader</a></li>
<li>
<ul class="inheritance">
<li>com.tiyb.tev.xml.ConversationXmlReader</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">ConversationXmlReader</span>
extends <a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html" title="class in com.tiyb.tev.xml">TEVXmlReader</a></pre>
<div class="block">This class is responsible for reading in an XML export from Tumblr containing
 conversations. A couple of interesting caveats:
 
 <ul>
 <li>message[@type=IMAGE] has a child element, for the photo's URL, whereas
 other messages just have the text of the message in the "message" element
 itself.</li>
 <li>For some reason two different formats are used for identifying users; the
 "participants" element has their <b>name</b>, but actual messages have their
 internal <b>ID</b>. These two don't relate to each other in any way. So the
 internal ID for the TEV user has to be inferred.</li>
 </ul></div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>tiyb</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.MessageSuperStructure</a></span></code>
<div class="block">Helper class (essentially a struct), returned from the
 <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getMessages-javax.xml.stream.XMLEventReader-java.lang.String-"><code>getMessages()</code></a> method, which needs to return more complicated data than just
 the list of messages - it also needs to determine the participant ID</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.Participant</a></span></code>
<div class="block">Helper class (essentially a struct), used for working with participant
 information.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.com.tiyb.tev.xml.TEVXmlReader">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;com.tiyb.tev.xml.<a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html" title="class in com.tiyb.tev.xml">TEVXmlReader</a></h3>
<code><a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html#END_OF_FILE_ERROR">END_OF_FILE_ERROR</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#ConversationXmlReader--">ConversationXmlReader</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#fixName-java.lang.String-">fixName</a></span>(java.lang.String&nbsp;participantName)</code>
<div class="block">Helper function used to "fix" names for deactivated users.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>private static <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.Participant</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getMainParticipant-java.io.InputStream-">getMainParticipant</a></span>(java.io.InputStream&nbsp;xmlStream)</code>
<div class="block">
 The XML is set up such that each conversation is between two participants:
 the main Tumblr user, and another user.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>private static <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.MessageSuperStructure</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getMessages-javax.xml.stream.XMLEventReader-java.lang.String-">getMessages</a></span>(javax.xml.stream.XMLEventReader&nbsp;reader,
           java.lang.String&nbsp;tumblrUserID)</code>
<div class="block">Gets a list of messages (stops when the end of the conversation is reached).</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>private static <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.Participant</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getParticipantName-javax.xml.stream.XMLEventReader-java.lang.String-">getParticipantName</a></span>(javax.xml.stream.XMLEventReader&nbsp;reader,
                  java.lang.String&nbsp;tumblrUserName)</code>
<div class="block">Helper function to get the participant name (and avatar URL) from a
 conversation.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#parseDocument-org.springframework.web.multipart.MultipartFile-com.tiyb.tev.controller.TEVMetadataRestController-com.tiyb.tev.controller.TEVConvoRestController-">parseDocument</a></span>(org.springframework.web.multipart.MultipartFile&nbsp;xmlFile,
             <a href="../../../../com/tiyb/tev/controller/TEVMetadataRestController.html" title="class in com.tiyb.tev.controller">TEVMetadataRestController</a>&nbsp;mdController,
             <a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;convoController)</code>
<div class="block">
 Main method.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>private static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#readConversations-java.io.InputStream-java.lang.String-java.lang.String-com.tiyb.tev.controller.TEVMetadataRestController-com.tiyb.tev.controller.TEVConvoRestController-">readConversations</a></span>(java.io.InputStream&nbsp;xmlFile,
                 java.lang.String&nbsp;mainTumblrUserName,
                 java.lang.String&nbsp;mainTumblrUserId,
                 <a href="../../../../com/tiyb/tev/controller/TEVMetadataRestController.html" title="class in com.tiyb.tev.controller">TEVMetadataRestController</a>&nbsp;mdController,
                 <a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;convoController)</code>
<div class="block">
 Reads in the XML file, conversation by conversation.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#readImageMessage-javax.xml.stream.XMLEventReader-">readImageMessage</a></span>(javax.xml.stream.XMLEventReader&nbsp;reader)</code>
<div class="block">This helper method reads in message content for IMAGE messages.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#readMessageAttributes-javax.xml.stream.events.StartElement-com.tiyb.tev.datamodel.ConversationMessage-java.lang.String-">readMessageAttributes</a></span>(javax.xml.stream.events.StartElement&nbsp;startElement,
                     <a href="../../../../com/tiyb/tev/datamodel/ConversationMessage.html" title="class in com.tiyb.tev.datamodel">ConversationMessage</a>&nbsp;currentMessage,
                     java.lang.String&nbsp;tumblrUserID)</code>
<div class="block">Helper method to read in a message's attributes</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>private static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#uploadMessagesForConvo-com.tiyb.tev.controller.TEVConvoRestController-java.util.List-java.lang.Long-">uploadMessagesForConvo</a></span>(<a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;restController,
                      java.util.List&lt;<a href="../../../../com/tiyb/tev/datamodel/ConversationMessage.html" title="class in com.tiyb.tev.datamodel">ConversationMessage</a>&gt;&nbsp;messages,
                      java.lang.Long&nbsp;convoID)</code>
<div class="block">Helper function to upload messages for a given conversation</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.tiyb.tev.xml.TEVXmlReader">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.tiyb.tev.xml.<a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html" title="class in com.tiyb.tev.xml">TEVXmlReader</a></h3>
<code><a href="../../../../com/tiyb/tev/xml/TEVXmlReader.html#readCharacters-javax.xml.stream.XMLEventReader-">readCharacters</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ConversationXmlReader--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ConversationXmlReader</h4>
<pre>public&nbsp;ConversationXmlReader()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="parseDocument-org.springframework.web.multipart.MultipartFile-com.tiyb.tev.controller.TEVMetadataRestController-com.tiyb.tev.controller.TEVConvoRestController-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parseDocument</h4>
<pre>public static&nbsp;void&nbsp;parseDocument(org.springframework.web.multipart.MultipartFile&nbsp;xmlFile,
                                 <a href="../../../../com/tiyb/tev/controller/TEVMetadataRestController.html" title="class in com.tiyb.tev.controller">TEVMetadataRestController</a>&nbsp;mdController,
                                 <a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;convoController)</pre>
<div class="block"><p>
 Main method. There are multiple steps to parsing the XML file:
 </p>
 
 <ol>
 <li>Get a stream for the file</li>
 <li>Use that stream to call the <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getMainParticipant-java.io.InputStream-"><code>getMainParticipant()</code></a> method to parse the XML document, to determine the main
 Tumblr user's name, avatar URL, and internal ID</li>
 <li>Update the application's metadata with that information</li>
 <li>Get a <i>new</i> stream (to start over at the beginning of the file)</li>
 <li>Use that stream to call the
 <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#readConversations-java.io.InputStream-java.lang.String-java.lang.String-com.tiyb.tev.controller.TEVMetadataRestController-com.tiyb.tev.controller.TEVConvoRestController-"><code>readConversations()</code></a> method to parse the document again, this time reading in
 all of the data (making use of the main Tumblr user information captured
 earlier)</li>
 </ol>
 
 <p>
 Data is inserted directly into the database, via the REST APIs (accessed via
 the <code>convoRestController</code> parameter).
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xmlFile</code> - File containing XML to be parsed</dd>
<dd><code>mdController</code> - Used for working with the application's metadata</dd>
<dd><code>convoController</code> - Used for updating the database as each
                        conversation/message is parsed</dd>
</dl>
</li>
</ul>
<a name="getMainParticipant-java.io.InputStream-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMainParticipant</h4>
<pre>private static&nbsp;<a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.Participant</a>&nbsp;getMainParticipant(java.io.InputStream&nbsp;xmlStream)</pre>
<div class="block"><p>
 The XML is set up such that each conversation is between two participants:
 the main Tumblr user, and another user. Therefore, this helper function
 parses through the XML document looking for participants; as soon as it finds
 a participant that's been listed <b>more than once,</b> it makes that
 participant the main Tumblr user, so it returns that user (and, URL for the
 user's avatar, and ID).
 </p>
 
 <p>
 There are two versions of the user in the XML: the <b>name</b> and an
 <b>opaque ID</b>, but they don't map to each other in the XML document, so
 there's no way to tell which ID belongs to which user. So the code also looks
 for duplicate versions of IDs; when an ID is found in multiple conversations,
 it's assumed to be the ID of the TEV user.
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xmlStream</code> - The XML file to be parsed</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>A <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml"><code>Participant</code></a> object, with the relevant data</dd>
</dl>
</li>
</ul>
<a name="readConversations-java.io.InputStream-java.lang.String-java.lang.String-com.tiyb.tev.controller.TEVMetadataRestController-com.tiyb.tev.controller.TEVConvoRestController-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readConversations</h4>
<pre>private static&nbsp;void&nbsp;readConversations(java.io.InputStream&nbsp;xmlFile,
                                      java.lang.String&nbsp;mainTumblrUserName,
                                      java.lang.String&nbsp;mainTumblrUserId,
                                      <a href="../../../../com/tiyb/tev/controller/TEVMetadataRestController.html" title="class in com.tiyb.tev.controller">TEVMetadataRestController</a>&nbsp;mdController,
                                      <a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;convoController)
                               throws <a href="../../../../com/tiyb/tev/exception/XMLParsingException.html" title="class in com.tiyb.tev.exception">XMLParsingException</a></pre>
<div class="block"><p>
 Reads in the XML file, conversation by conversation. Whenever a new
 conversation element is reached a new object is created, the participant is
 discovered (via <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getParticipantName-javax.xml.stream.XMLEventReader-java.lang.String-"><code>getParticipantName()</code></a>, and then <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#getMessages-javax.xml.stream.XMLEventReader-java.lang.String-"><code>getMessages()</code></a> is called to get all of the messages. The count of that list
 is added to the conversation object.
 </p>
 
 <p>
 Logic also takes into account the "overwrite conversations" flag in metadata.
 If the flag is set, all data is wiped ahead of time. When the flag is not
 set, as each conversation is encountered the REST API is used to look for
 that conversation: if it's found and the number of new messages isn't greater
 than the number of existing messages it is left alone; otherwise, messages
 are wiped, the conversation is set to no longer be read-only, and the new set
 of messages is uploaded.
 </p>
 
 <p>
 Finally, it should be noted that participant <b>names</b> sometimes change,
 but their <b>IDs</b> stay the same. So when searching the database for
 existing conversations, the search is initially done by ID. In cases where a
 participant has <i>changed</i> their name (and overwrite is set to false),
 the name will be updated in the DB. In some cases, where all of the messages
 were sent from the main blog (none received from the participant), the
 conversation is saved to the DB with an empty Participant ID (since the only
 place to get that ID is from a message received from the Participant). For
 this reason, the search for Conversations has a fallback, whereby it searches
 by name if searching by ID turns up 0 results. In cases where where 1) an
 initial import is performed, including a conversation with messages sent from
 the main blog and non received from the Participant; 2) a new export is
 uploaded (with overwrite turned off); 3) the conversation was augmented with
 messages from the Participant; <i>and</i> 4) the Participant changed their
 name, a duplicate conversation will be created.
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xmlFile</code> - Stream containing the XML file to be parsed</dd>
<dd><code>mainTumblrUserName</code> - The Tumblr name of the user of the application</dd>
<dd><code>mainTumblrUserId</code> - The ID assigned to the user of the application by
                           Tumblr</dd>
<dd><code>mdController</code> - Controller used to update the database with
                           conversations/messages</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../com/tiyb/tev/exception/XMLParsingException.html" title="class in com.tiyb.tev.exception">XMLParsingException</a></code></dd>
</dl>
</li>
</ul>
<a name="uploadMessagesForConvo-com.tiyb.tev.controller.TEVConvoRestController-java.util.List-java.lang.Long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>uploadMessagesForConvo</h4>
<pre>private static&nbsp;void&nbsp;uploadMessagesForConvo(<a href="../../../../com/tiyb/tev/controller/TEVConvoRestController.html" title="class in com.tiyb.tev.controller">TEVConvoRestController</a>&nbsp;restController,
                                           java.util.List&lt;<a href="../../../../com/tiyb/tev/datamodel/ConversationMessage.html" title="class in com.tiyb.tev.datamodel">ConversationMessage</a>&gt;&nbsp;messages,
                                           java.lang.Long&nbsp;convoID)</pre>
<div class="block">Helper function to upload messages for a given conversation</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>restController</code> - The controller for accessing the REST API</dd>
<dd><code>messages</code> - The messages to upload</dd>
<dd><code>convoID</code> - The ID of the conversation</dd>
</dl>
</li>
</ul>
<a name="getMessages-javax.xml.stream.XMLEventReader-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMessages</h4>
<pre>private static&nbsp;<a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.MessageSuperStructure</a>&nbsp;getMessages(javax.xml.stream.XMLEventReader&nbsp;reader,
                                                                       java.lang.String&nbsp;tumblrUserID)
                                                                throws javax.xml.stream.XMLStreamException</pre>
<div class="block">Gets a list of messages (stops when the end of the conversation is reached).
 The two attributes are read (via
 <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.html#readMessageAttributes-javax.xml.stream.events.StartElement-com.tiyb.tev.datamodel.ConversationMessage-java.lang.String-"><code>readMessageAttributes()</code></a>), followed by the text of the element.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>reader</code> - Stream containing the XML document being read</dd>
<dd><code>tumblrUserID</code> - Tumblr ID of the TEV user</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>list of messages, instead a
         <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml"><code>MessageSuperStructure</code></a> object</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>javax.xml.stream.XMLStreamException</code></dd>
</dl>
</li>
</ul>
<a name="readImageMessage-javax.xml.stream.XMLEventReader-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readImageMessage</h4>
<pre>private static&nbsp;java.lang.String&nbsp;readImageMessage(javax.xml.stream.XMLEventReader&nbsp;reader)
                                          throws javax.xml.stream.XMLStreamException</pre>
<div class="block">This helper method reads in message content for IMAGE messages. The structure
 of an IMAGE is different from other messages; typically, the message contents
 are simply the child text of the "message" element, but when the type is
 IMAGE, there is a child "photo-url" element as well. The "photo-url" also has
 a max-width attribute, but this app ignores it</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>reader</code> - The event reader containing the XML document</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>String for the message content - i.e., the photo's URL</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>javax.xml.stream.XMLStreamException</code></dd>
</dl>
</li>
</ul>
<a name="readMessageAttributes-javax.xml.stream.events.StartElement-com.tiyb.tev.datamodel.ConversationMessage-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readMessageAttributes</h4>
<pre>private static&nbsp;java.lang.String&nbsp;readMessageAttributes(javax.xml.stream.events.StartElement&nbsp;startElement,
                                                      <a href="../../../../com/tiyb/tev/datamodel/ConversationMessage.html" title="class in com.tiyb.tev.datamodel">ConversationMessage</a>&nbsp;currentMessage,
                                                      java.lang.String&nbsp;tumblrUserID)</pre>
<div class="block">Helper method to read in a message's attributes</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>startElement</code> - The <code>StartElement</code> object currently being processed</dd>
<dd><code>currentMessage</code> - The message to add the data to</dd>
<dd><code>tumblrUserID</code> - The ID of the main user</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The ID of the participant</dd>
</dl>
</li>
</ul>
<a name="getParticipantName-javax.xml.stream.XMLEventReader-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getParticipantName</h4>
<pre>private static&nbsp;<a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml">ConversationXmlReader.Participant</a>&nbsp;getParticipantName(javax.xml.stream.XMLEventReader&nbsp;reader,
                                                                    java.lang.String&nbsp;tumblrUserName)
                                                             throws javax.xml.stream.XMLStreamException</pre>
<div class="block">Helper function to get the participant name (and avatar URL) from a
 conversation. Each conversation contains a list of exactly two participants:
 the TEV user, and the <i>other</i> participant. Each "participant" element is
 read, and the one that is <i>not</i> that of the current Tumblr user is
 returned.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>reader</code> - The reader from which to read the "participant"
                       elements</dd>
<dd><code>tumblrUserName</code> - Tumblr name of the TEV user</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Helper <a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.Participant.html" title="class in com.tiyb.tev.xml"><code>Participant</code></a> object, with the details of the <i>other</i>
         (non-TEV-user) participant in the conversation</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>javax.xml.stream.XMLStreamException</code></dd>
</dl>
</li>
</ul>
<a name="fixName-java.lang.String-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>fixName</h4>
<pre>private static&nbsp;java.lang.String&nbsp;fixName(java.lang.String&nbsp;participantName)</pre>
<div class="block">Helper function used to "fix" names for deactivated users. When a user has
 been deactivated, Tumblr returns the name as
 <code>username-deactivated</code> or
 <code>username-deactivatedyyyymmdd</code> or even
 <code>username-deact</code>. This function just keeps the username, without
 the "-deactivated" or "-deactivatedyyyymmdd" part.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>participantName</code> - "raw" username</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Username without the postfix (if any)</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ConversationXmlReader.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/tiyb/tev/xml/BlogXmlReader.html" title="class in com.tiyb.tev.xml"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/tiyb/tev/xml/ConversationXmlReader.MessageSuperStructure.html" title="class in com.tiyb.tev.xml"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/tiyb/tev/xml/ConversationXmlReader.html" target="_top">Frames</a></li>
<li><a href="ConversationXmlReader.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#fields.inherited.from.class.com.tiyb.tev.xml.TEVXmlReader">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2019. All Rights Reserved.</small></p>
</body>
</html>
